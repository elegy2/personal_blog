---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogPost from '../../components/BlogPost.astro';

export async function getStaticPaths() {
  const allPosts = Object.values(import.meta.glob('../posts/*.md', { eager: true }));

  const uniqueTags = [...new Set(allPosts.map((post: any) => post.frontmatter.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post: any) => post.frontmatter.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---
<BaseLayout pageTitle={tag}>
  <div class="tag-page">
    <header class="tag-header">
      <h1 class="tag-title">#{tag}</h1>
      <p class="tag-subtitle">共 {posts.length} 篇文章</p>
    </header>

    <div class="card-grid">
      {posts.map((post: any) => (
        <a href={post.url} class="card">
          <div class="card-inner">
            <div class="card-front">
              <h2>{post.frontmatter.title}</h2>
            </div>
            <div class="card-back">
              <p>{post.frontmatter.description || '点击查看详情 →'}</p>
            </div>
          </div>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Montserrat:wght@600;800&display=swap');

  body {
    font-family: "Inter", sans-serif;
    background-size: cover;
    position: relative;
    min-height: 100vh;
  }

  body::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(transparent 60%, rgba(0,0,0,0.85));
    z-index: -1;
  }

  .tag-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 4rem 2rem;
    animation: fadeIn 1.2s ease forwards;
  }

  .tag-header {
    text-align: center;
    margin-bottom: 3rem;
    animation: slideDown 1s ease forwards;
  }

  .tag-title {
    font-size: 3rem;
    font-weight: 800;
    letter-spacing: 4px;
    color: white;
    background: linear-gradient(135deg, #60a5fa, #2563eb);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-family: "Montserrat", sans-serif;
  }

  .tag-subtitle {
    margin-top: 0.5rem;
    font-size: 1.2rem;
    color: rgba(255,255,255,0.8);
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1.5rem;
  }

  .card {
    perspective: 1000px;
    text-decoration: none;
  }

  .card-inner {
    position: relative;
    width: 100%;
    height: 180px;
    border-radius: 16px;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  }

  .card:hover .card-inner {
    transform: rotateY(180deg);
    box-shadow: 0 0 25px rgba(96, 165, 250, 0.6);
  }

  .card-front,
  .card-back {
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 1.2rem;
    color: white;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .card-front {
    background: rgba(255,255,255,0.08);
    font-size: 1.2rem;
    font-weight: 600;
  }

  .card-back {
    background: rgba(37, 99, 235, 0.8);
    transform: rotateY(180deg);
    font-size: 1rem;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
